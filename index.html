<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>롤 구도, 챔피언 정보 페이지</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Summernote CSS -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css" rel="stylesheet">
    <!-- External CSS File -->
    <link href="style.css" rel="stylesheet">
</head>
<body>
    <!-- 상단 메뉴 영역 -->
    <div id="menu" class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">군밤 구도 익스포터</a>
            </div>
            <ul class="nav navbar-nav">
                <!-- 기존 메뉴 항목들 -->

                <li><a href="https://cyborgman.tistory.com/entry/%EB%B0%A9%EC%86%A1%EC%84%B8%ED%8C%85-%ED%86%B5%ED%95%A9%EB%AC%B8%EC%84%9C" target="_blank">제작: 군밤가이</a></li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <!-- 오른쪽 메뉴 영역 (필요 시 추가) -->
            </ul>
            <!-- 기존 버튼들 -->
            <button id="load-data-button" class="btn btn-primary navbar-btn">문자열 로딩</button>
            <button id="copy-to-clipboard-button" class="btn btn-primary">문자열 내보내기</button>
			
	        <button id="set-folder-button" class="btn btn-primary navbar-btn">폴더 설정</button>
			<button id="open-folder-button" class="btn btn-primary navbar-btn">폴더 열기</button>
			<button id="load-default-button" class="btn btn-primary navbar-btn">기본값</button>
    
            
        </div>
    </div>

    <div id="container">
        <!-- 상단과 하단을 분할하기 위한 상하 Split 컨테이너 -->
        <div id="top-container" class="top-container">
            <!-- 좌우 분할을 위한 Split 컨테이너 -->
            <div id="split-container" class="split-container">
                <!-- 왼쪽 챔피언 정보 영역 -->
                <div id="info-container" class="split-section">
                    <h2>챔피언 정보</h2>
                    <div id="champion-info">
                        <!-- 챔피언 이미지, 스킬 아이콘, 스킬 설명 등이 표시됩니다 -->
                    </div>
                </div>

                <!-- 좌우 드래그바 -->
                <div class="divider vertical-divider" id="vertical-divider-left"></div>

                <!-- 가운데 메인 콘텐츠 영역 -->
                <div id="main-container" class="split-section">
                    <button id="select-champion-button">챔피언 선택</button>
                    <div class="slot-buttons">
                        <button id="add-slot-button">+</button>
                        <button id="remove-slot-button">-</button>
                    </div>

                    <!-- 데이터 내보내기/불러오기 버튼 -->
                    <div class="data-buttons">
                        <button id="export-data-button">데이터 내보내기</button>
                        <button id="import-data-button">데이터 불러오기</button>
                        <input type="file" id="import-file-input" style="display:none;" accept=".txt">
                    </div>

                    <div id="champion-selection" class="modal">
                        <div class="modal-content">
                            <h2>역할 선택</h2>
                            <div id="role-selection">
                                <!-- 역할 버튼들이 여기에 생성됩니다 -->
                            </div>
                            <h2>챔피언 선택</h2>
                            <div id="champion-list">
                                <!-- 챔피언 리스트가 여기에 생성됩니다 -->
                            </div>
                            <button id="close-modal-button">닫기</button>
                        </div>
                    </div>

                    <h2>양팀 포지션별 챔피언 (2x5 배열)</h2>
                    <div id="team-slots">
                        <div id="my-team" class="team-container">
                            <h3>내 팀</h3>
                            <div class="team">
                                <!-- 내 팀 슬롯이 여기에 동적으로 추가됨 -->
                            </div>
                        </div>
                        <div id="enemy-team" class="team-container">
                            <h3>상대 팀</h3>
                            <div class="team">
                                <!-- 상대 팀 슬롯이 여기에 동적으로 추가됨 -->
                            </div>
                        </div>
                        <!-- 비교 버튼을 표시할 위치 -->
                        <div id="comparison-buttons" class="comparison-container">
                            <!-- 비교 버튼이 여기에 동적으로 추가됨 -->
                        </div>
                    </div>
                </div>

                <!-- 좌우 드래그바 -->
                <div class="divider vertical-divider" id="vertical-divider-right"></div>

                <!-- 오른쪽 메모 작성 영역 -->
                <div id="memo-container" class="split-section">
                    <h2>메모</h2>
                    <div id="editor"></div>
                    <button id="save-memo-button">메모 저장</button>
                </div>
            </div>

            <!-- 상하 드래그바 추가 -->
            <div id="horizontal-divider" class="resize-handle-horizontal"></div>
        </div>

        <!-- 하단 구도 메모 영역 -->
        <div id="formation-container">
            <h2>구도페이지 메모</h2>
            <div id="formation-editor"></div>
	    <!-- 새로운 구도 저장 버튼만 남김 -->
            <button id="save-formation-button" class="btn btn-success navbar-btn">구도 저장</button>
            <!-- 구도 메모 저장 버튼 추가 -->
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
		<!-- External JavaScript Files -->
	<script src="main.js"></script>
	<script src="folder.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!-- Summernote JS -->
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
    <!-- Summernote Korean Language Pack -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.18/lang/summernote-ko-KR.min.js"></script>
    <!-- External JavaScript File -->

    <script>
        // 데이터 로딩 버튼 이벤트 리스너 추가
        $(document).ready(function() {
            $('#load-data-button').on('click', function() {
                const base64Data = prompt('불러올 데이터를 입력하세요:');
                if (base64Data) {
                    try {
                        const jsonStr = decodeURIComponent(escape(atob(base64Data)));
                        const data = JSON.parse(jsonStr);

                        // 데이터 적용
                        version = data.version;
                        myTeamSlots = data.myTeamSlots;
                        enemyTeamSlots = data.enemyTeamSlots;
                        formationMemos = data.formationMemos || {}; // 추가된 부분

                        // 챔피언 데이터 다시 로드
                        fetch(`https://ddragon.leagueoflegends.com/cdn/${version}/data/ko_KR/champion.json`)
                            .then(response => response.json())
                            .then(championData => {
                                championList = championData.data;

                                // 슬롯 초기화
                                initializeTeamSlots();

                                // 내 팀 챔피언 설정
                                const myTeamContainer = $('#my-team').find('.team');
                                for (let i = 0; i < data.myTeam.length; i++) {
                                    const slot = myTeamContainer.children().eq(i)[0];
                                    if (data.myTeam[i]) {
                                        setChampionToSlot(slot, data.myTeam[i]);
                                    }
                                }

                                // 상대 팀 챔피언 설정
                                const enemyTeamContainer = $('#enemy-team').find('.team');
                                for (let i = 0; i < data.enemyTeam.length; i++) {
                                    const slot = enemyTeamContainer.children().eq(i)[0];
                                    if (data.enemyTeam[i]) {
                                        setChampionToSlot(slot, data.enemyTeam[i]);
                                    }
                                }

                                // 메모 데이터 설정
                                $('#editor').summernote('code', data.memoContent || '');
                                $('#formation-editor').summernote('code', data.formationMemo || '');

                                // IndexedDB에 formations 저장
                                if (db) {
                                    const transaction = db.transaction(['formations'], 'readwrite');
                                    const store = transaction.objectStore('formations');
                                    store.clear(); // 기존 formations 삭제
                                    for (const key in formationMemos) {
                                        store.put({ key: key, memoContent: formationMemos[key] });
                                    }
                                }

                                alert('데이터가 성공적으로 불러와졌습니다.');
                            })
                            .catch(error => {
                                console.error('챔피언 데이터 로드 실패:', error);
                                alert('챔피언 데이터 로드에 실패했습니다.');
                            });
                    } catch (error) {
                        console.error(error);
                        alert('데이터 불러오기에 실패했습니다.');
                    }
                }
            });
        });
    </script>
</body>
</html>
